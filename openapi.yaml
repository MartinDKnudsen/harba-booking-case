openapi: 3.0.3
info:
  title: Harba Booking API
  version: 1.0.0
servers:
  - url: http://localhost:8080
paths:
  /api/register:
    post:
      summary: Register new user
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 6
      responses:
        '201':
          description: User created
        '409':
          description: Email already exists
        '422':
          description: Validation error
  /api/login:
    post:
      summary: Login and get API token
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        '200':
          description: Authenticated
          content:
            application/json:
              schema:
                type: object
                properties:
                  id: { type: integer }
                  email: { type: string, format: email }
                  roles:
                    type: array
                    items: { type: string }
                  token: { type: string }
        '401':
          description: Invalid credentials
  /api/me:
    get:
      summary: Get current user
      tags: [Auth]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthenticated
  /api/services:
    get:
      summary: List services
      tags: [Catalog]
      responses:
        '200':
          description: List of services
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Service'
  /api/providers:
    get:
      summary: List providers
      tags: [Catalog]
      responses:
        '200':
          description: List of providers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Provider'
  /api/providers/{id}/slots:
    get:
      summary: Get available slots for a provider
      tags: [Slots]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
        - in: query
          name: from
          schema: { type: string, format: date }
        - in: query
          name: to
          schema: { type: string, format: date }
      responses:
        '200':
          description: Available slots
          content:
            application/json:
              schema:
                type: object
                properties:
                  providerId: { type: integer }
                  from: { type: string, format: date }
                  to: { type: string, format: date }
                  slots:
                    type: array
                    items:
                      type: string
                      format: date-time
        '404':
          description: Provider not found
  /api/bookings:
    post:
      summary: Create booking
      tags: [Bookings]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [provider_id, service_id, start_at]
              properties:
                provider_id: { type: integer }
                service_id: { type: integer }
                start_at:
                  type: string
                  format: date-time
                note:
                  type: string
                  nullable: true
      responses:
        '201':
          description: Booking created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Booking'
        '400':
          description: Invalid time or slot not available
        '404':
          description: Provider or service not found
        '409':
          description: Slot already booked
        '422':
          description: Validation error
  /api/my/bookings:
    get:
      summary: List current user's bookings
      tags: [Bookings]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of bookings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BookingSummary'
        '401':
          description: Unauthenticated
  /api/bookings/{id}/cancel:
    post:
      summary: Cancel a booking
      tags: [Bookings]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Booking cancelled
        '400':
          description: Already cancelled or deleted
        '403':
          description: Forbidden
        '404':
          description: Not found
  /api/admin/bookings:
    get:
      summary: List all bookings (admin)
      tags: [Admin]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of all bookings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AdminBooking'
        '401':
          description: Unauthenticated
        '403':
          description: Forbidden
  /api/admin/bookings/{id}/delete:
    post:
      summary: Soft delete booking (admin)
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Booking soft deleted
        '400':
          description: Already deleted
        '403':
          description: Forbidden
        '404':
          description: Not found

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: API token
  schemas:
    User:
      type: object
      properties:
        id: { type: integer }
        email: { type: string, format: email }
        roles:
          type: array
          items: { type: string }
    Service:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }
        durationMinutes: { type: integer }
    Provider:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }
        workingHours:
          type: object
          additionalProperties: true
    Booking:
      type: object
      properties:
        id: { type: integer }
        userId: { type: integer }
        providerId: { type: integer }
        serviceId: { type: integer }
        startAt:
          type: string
          format: date-time
        note:
          type: string
          nullable: true
        cancelled: { type: boolean }
        deleted: { type: boolean }
    BookingSummary:
      type: object
      properties:
        id: { type: integer }
        providerId: { type: integer }
        serviceId: { type: integer }
        startAt:
          type: string
          format: date-time
        note:
          type: string
          nullable: true
        cancelled: { type: boolean }
    AdminBooking:
      type: object
      properties:
        id: { type: integer }
        userId:
          type: integer
          nullable: true
        userEmail:
          type: string
          format: email
          nullable: true
        providerId:
          type: integer
          nullable: true
        serviceId:
          type: integer
          nullable: true
        startAt:
          type: string
          format: date-time
        note:
          type: string
          nullable: true
        cancelled: { type: boolean }
        deleted: { type: boolean }
